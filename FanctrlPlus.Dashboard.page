Menu="Dashboard:0"
Cond="version_compare(parse_ini_file('/etc/unraid-version')['version'],'6.11.9','>')"
---
<?php
$pluginname = "fanctrlplus";
$cfg_path = "/boot/config/plugins/$pluginname";
$cfg_files = glob("$cfg_path/{$pluginname}_*.cfg");

$tile_rows = "";
foreach ($cfg_files as $i => $file) {
  $cfg = parse_ini_file($file);
  if (($cfg['service'] ?? '0') !== '1') continue;

  $name = $cfg['custom'] ?? basename($file);
  $rpm = file_exists("/var/tmp/fanctrlplus/rpm_$i") ? trim(file_get_contents("/var/tmp/fanctrlplus/rpm_$i")) : "-";
  $status = file_exists("/var/run/fanctrlplus_${i}.pid") ? "running" : "stopped";

  $frame_color = $status === "running" ? "#000000" : "#cc0000";
  $hub_color   = $status === "running" ? "#666666" : "#ff6666";
  $icon_id = "fan-icon-dashboard-$i";

  $tile_rows .= "
<tr><td>
  <div style='display:flex; align-items:center; gap:10px;'>
    <svg id='$icon_id' class='fan-svg' width='20' height='20' viewBox='0 0 100 100'>
      <circle class='frame' cx='50' cy='50' r='45' fill='$frame_color' />
      <circle class='hub' cx='50' cy='50' r='10' fill='$hub_color' />
    </svg>
    <span>$name – $rpm RPM</span>
  </div>
</td></tr>";
}

$mytiles[$pluginname]['column1'] = <<<EOT
<tbody id="fanctrlplus-dashboard" title="FanCtrl Plus">
<tr><td>
  <a href="/Settings/fanctrlplus" title="Go to FanCtrl Plus settings">
    <i class="fa fa-fw fa-cog control"></i>
  </a>
  <div class="section">FanCtrl Plus<br>Status: <span class="green-text">Running</span></div>
</td></tr>
<tr><td><span>HDD Bay – 1400 RPM</span></td></tr>
<tr><td><span>Enclosure – 890 RPM</span></td></tr>
</tbody>
EOT;
?>
