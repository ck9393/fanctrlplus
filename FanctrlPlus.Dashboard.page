Menu="Dashboard:0"
Cond="version_compare(parse_ini_file('/etc/unraid-version')['version'],'6.11.9','>')"
---
<?php
$pluginname = "fanctrlplus";
$cfg_path = "/boot/config/plugins/$pluginname";
$cfg_files = glob("$cfg_path/{$pluginname}_*.cfg");
$icon = "<img src='/plugins/fanctrlplus/images/fanctrlplus.png' style='width:20px; height:20px; vertical-align:middle; margin-right:6px'>";

$tile_rows = "";
foreach ($cfg_files as $i => $file) {
  $cfg = parse_ini_file($file);
  if (($cfg['service'] ?? '0') !== '1') continue;

  $name = $cfg['custom'] ?? basename($file);
  $rpm = file_exists("/var/tmp/fanctrlplus/rpm_$i") ? trim(file_get_contents("/var/tmp/fanctrlplus/rpm_$i")) : "-";
  $tile_rows .= "<tr><td>$name â€“ $rpm RPM</td></tr>";
}

$status = file_exists("/var/run/fanctrlplus_loop.pid") ? "Running" : "Stopped";
$color = $status === "Running" ? "green" : "red";

$mytiles[$pluginname]['column1'] = <<<EOT
<tbody id="fanctrlplus-dashboard" title="FanCtrl Plus">
<tr><td>
  <div class="section">
    $icon <strong>FANCTRL PLUS</strong><br>
    <span><strong>Status:</strong> <span style="color:$color">$status</span></span>
  </div>
</td></tr>
$tile_rows
<tr><td><a class="settings" href="/Settings/fanctrlplus" title="Go to FanCtrl Plus settings"><i class="fa fa-cog"></i></a></td></tr>
</tbody>
EOT;
?>
